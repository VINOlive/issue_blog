<map version="1.0.1">
<!-- To view this file, download free mind mapping software FreeMind from http://freemind.sourceforge.net -->
<node COLOR="#000000" CREATED="1436872198241" ID="ID_118543821" MODIFIED="1436881068610" TEXT="ibrowse">
<font NAME="SansSerif" SIZE="8"/>
<hook NAME="accessories/plugins/HierarchicalIcons.properties"/>
<node COLOR="#0033ff" CREATED="1436872522883" ID="ID_1982162080" MODIFIED="1436881068413" POSITION="right" STYLE="fork" TEXT="ibrowse:start">
<edge STYLE="sharp_bezier" WIDTH="8"/>
<font NAME="SansSerif" SIZE="18"/>
<node COLOR="#00b439" CREATED="1436872549443" ID="ID_1342747960" MODIFIED="1436878789494" TEXT="init">
<edge STYLE="bezier" WIDTH="thin"/>
<font NAME="SansSerif" SIZE="16"/>
<node COLOR="#990000" CREATED="1436872555468" ID="ID_633026390" MODIFIED="1436878789495" TEXT="ets:new ibrowse_lb">
<font NAME="SansSerif" SIZE="14"/>
<node COLOR="#111111" CREATED="1436873028077" ID="ID_1263322983" MODIFIED="1436878539786" TEXT="key = {Host, Port}, value = Pid =ibrowse_lb:start_link/2"/>
<node COLOR="#111111" CREATED="1436873090360" ID="ID_683867354" MODIFIED="1436878789497" TEXT="&#x4e3a;&#x6bcf;&#x4e00;&#x4e2a;{Host, Port}&#x521b;&#x5efa;&#x4e00;&#x4e2a;gen_server&#x6765;&#x7ba1;&#x7406;&#x8fde;&#x63a5;">
<node COLOR="#111111" CREATED="1436873444400" ID="ID_475148260" MODIFIED="1436878789498" TEXT="init">
<node COLOR="#111111" CREATED="1436873447774" ID="ID_142237979" MODIFIED="1436878789502" TEXT="State&#x5b58;&#x50a8;">
<node COLOR="#111111" CREATED="1436873543780" ID="ID_1332491556" MODIFIED="1436878539789" TEXT="parent_pid = whereis(ibrowse)"/>
<node COLOR="#111111" CREATED="1436873569629" ID="ID_886143705" MODIFIED="1436878539790" TEXT="host"/>
<node COLOR="#111111" CREATED="1436873576873" ID="ID_361014656" MODIFIED="1436878539791" TEXT="port"/>
<node COLOR="#111111" CREATED="1436873579079" ID="ID_1949618641" MODIFIED="1436878789503" TEXT="ets_tid = ets:new(ibrowser_lb,[public,ordered_set]).">
<node COLOR="#111111" CREATED="1436873648779" ID="ID_1917107916" MODIFIED="1436878539794" TEXT="&#x6709;&#x5e8f;&#xff0c;&#x65e0;&#x540d;&#x7684;ets"/>
</node>
<node COLOR="#111111" CREATED="1436873622693" ID="ID_451528753" MODIFIED="1436878539796" TEXT="max_pipeline_size"/>
<node COLOR="#111111" CREATED="1436873632244" ID="ID_266226866" MODIFIED="1436878539797" TEXT="max_sessions"/>
<node COLOR="#111111" CREATED="1436873845228" ID="ID_127766944" MODIFIED="1436878539798" TEXT="num_cur_sessions"/>
</node>
</node>
<node COLOR="#111111" CREATED="1436873751417" ID="ID_247361483" MODIFIED="1436878789505" TEXT="&#x65b0;&#x5efa;&#x4e00;&#x4e2a;&#x8fde;&#x63a5;spawn_connection">
<node COLOR="#111111" CREATED="1436874080817" ID="ID_1059154833" MODIFIED="1436878539799" TEXT="0. num_cur_sessions+1"/>
<node COLOR="#111111" CREATED="1436873892682" ID="ID_346306363" MODIFIED="1436878789506" TEXT="1.&#x5982;&#x679c;num_cur_sessions&lt;Max_sessions">
<node COLOR="#111111" CREATED="1436873950420" ID="ID_1225005323" MODIFIED="1436878789509" TEXT="ibrowse_http_client:start_link/2">
<node COLOR="#111111" CREATED="1436875004977" ID="ID_1251553663" MODIFIED="1436878789510" TEXT="init">
<node COLOR="#111111" CREATED="1436875007388" ID="ID_834244131" MODIFIED="1436878539803" TEXT="&#x5b58;&#x7236;&#x8fdb;&#x7a0b;&#x521b;&#x5efa;&#x7684;ets:ibrowse_lib&#x7528;&#x6765;&#x65b0;&#x8fde;&#x63a5;&#x6210;&#x529f;&#x540e;&#x66f4;&#x65b0;cur_count"/>
<node COLOR="#111111" CREATED="1436875400850" ID="ID_554762474" MODIFIED="1436878539804" TEXT="&#x4ece;&#x914d;&#x7f6e;&#x4e2d;&#x8bbe;&#x7f6e;timout&#x65f6;&#x95f4;inactivity_timeout"/>
</node>
<node COLOR="#111111" CREATED="1436875496218" ID="ID_292967990" MODIFIED="1436878789512" TEXT="send_req/7">
<node COLOR="#111111" CREATED="1436875596641" ID="ID_591736250" MODIFIED="1436878807180" TEXT="send_req_1 check connect options">
<node COLOR="#111111" CREATED="1436875639337" ID="ID_857621955" MODIFIED="1436878809295" TEXT="do_connect">
<node COLOR="#111111" CREATED="1436875773768" ID="ID_305841586" MODIFIED="1436878539807" TEXT="ssl:connect"/>
<node COLOR="#111111" CREATED="1436875781828" ID="ID_1761798791" MODIFIED="1436878539808" TEXT="gen_tcp:connect"/>
<node COLOR="#111111" CREATED="1436875790028" ID="ID_1707062258" MODIFIED="1436878539808" TEXT="ibrowse_socks5:connect"/>
</node>
<node COLOR="#111111" CREATED="1436875900550" ID="ID_1443325304" MODIFIED="1436878809298" TEXT="do_send">
<node COLOR="#111111" CREATED="1436875905617" ID="ID_454528352" MODIFIED="1436878539809" TEXT="maybe_modify_headers"/>
<node COLOR="#111111" CREATED="1436875914168" ID="ID_49488730" MODIFIED="1436878539809" TEXT="make_request"/>
<node COLOR="#111111" CREATED="1436875996791" FOLDED="true" ID="ID_1791945378" MODIFIED="1436878791553" TEXT="do_send/2">
<node COLOR="#111111" CREATED="1436876008221" ID="ID_109162451" MODIFIED="1436878539811" TEXT="gen_tcp:send"/>
<node COLOR="#111111" CREATED="1436876020549" ID="ID_635099882" MODIFIED="1436878539811" TEXT="ssl:send"/>
</node>
</node>
<node COLOR="#111111" CREATED="1436876024083" ID="ID_1267840750" MODIFIED="1436878809298" TEXT="do_send_body">
<node COLOR="#111111" CREATED="1436876093201" ID="ID_856435388" MODIFIED="1436878539813" TEXT="chunked data"/>
</node>
<node COLOR="#111111" CREATED="1436876136475" ID="ID_692745412" MODIFIED="1436878539814" TEXT="inet:setopts(socket,[{active,once}])."/>
<node COLOR="#111111" CREATED="1436876201096" ID="ID_1778339248" MODIFIED="1436878539814" TEXT="inc_pipeline_counter ets:ibrowse_lb"/>
<node COLOR="#111111" CREATED="1436876404436" ID="ID_644544359" MODIFIED="1436878809300" TEXT="{noreply, State_3};">
<node COLOR="#111111" CREATED="1436876411466" FOLDED="true" ID="ID_648752769" MODIFIED="1436878791554" TEXT="&#x6ce8;&#x610f;&#x8fd9;&#x91cc;&#x7684;noreply&#x56de;&#x590d;&#x7684;call&#xff0c;&#x662f;&#x4e3a;&#x4e86;&#x8ba9;&#x5176;&#x5b83;&#x7684;&#x8bf7;&#x6c42;&#x4e0d;&#x963b;&#x585e;">
<node COLOR="#111111" CREATED="1436876411891" ID="ID_723668191" MODIFIED="1436878539816" TEXT=""/>
</node>
<node COLOR="#111111" CREATED="1436876506861" ID="ID_1578333943" MODIFIED="1436878539817" TEXT="&#x5b83;&#x8fd8;&#x662f;&#x6ca1;&#x6709;&#x8fd4;&#x56de;&#xff0c;&#x662f;&#x8fb9;&#x5904;&#x7406;&#x5176;&#x5b83;&#x8fb9;&#x5728;&#xff1d;response"/>
</node>
</node>
</node>
<node COLOR="#111111" CREATED="1436876812676" ID="ID_873321155" MODIFIED="1436878789528" TEXT="handle_info&#x5904;&#x7406;socket&#x8fd4;&#x56de;&#x7684;&#x6570;&#x636e;">
<node COLOR="#111111" CREATED="1436876817301" ID="ID_322335448" MODIFIED="1436878539822" TEXT="{tcp,Sock,Data}"/>
<node COLOR="#111111" CREATED="1436876831475" ID="ID_1458735667" MODIFIED="1436878539823" TEXT="{ssl,Socket,Data}"/>
<node COLOR="#111111" CREATED="1436876844838" ID="ID_769802034" MODIFIED="1436878539823" TEXT="{stream_next,ReqId}"/>
<node COLOR="#111111" CREATED="1436877427228" ID="ID_547596603" MODIFIED="1436878807181" TEXT="parse_response">
<node COLOR="#111111" CREATED="1436877437431" ID="ID_1494587205" MODIFIED="1436878539825" TEXT="gen_server:reply request"/>
<node COLOR="#111111" CREATED="1436877456144" ID="ID_18753702" MODIFIED="1436878539829" TEXT="dec cur_count"/>
</node>
<node COLOR="#111111" CREATED="1436877199560" ID="ID_528639996" MODIFIED="1436878539830" TEXT="get_head"/>
<node COLOR="#111111" CREATED="1436877206601" ID="ID_1224830158" MODIFIED="1436878807182" TEXT="get_body">
<node COLOR="#111111" CREATED="1436877037590" ID="ID_1558138358" MODIFIED="1436878539832" TEXT="&#x521b;&#x5efa;&#x4e00;&#x4e2a;&#x4e34;&#x65f6;&#x6587;&#x4ef6;&#x6765;accumulate_response"/>
</node>
</node>
<node COLOR="#111111" CREATED="1436877034177" ID="ID_1465014474" MODIFIED="1436878539833" TEXT=""/>
</node>
</node>
<node COLOR="#111111" CREATED="1436873825779" ID="ID_1947994903" MODIFIED="1436878789531" TEXT="2.&#x5982;&#x679c;&#x5df2;&#x6709;&#x8fde;&#x63a5;num_cur_sessions&gt;= Max_sessions">
<node COLOR="#111111" CREATED="1436873981099" ID="ID_927781201" MODIFIED="1436878539840" TEXT="Sessions&#x5df2;&#x6ee1;&#xff0c;&#x4f46;&#x6bcf;&#x4e2a;sessions&#x7684;&#x5904;&#x7406;&#x80fd;&#x529b;&#x6ca1;&#x6709;&#x6ee1;"/>
<node COLOR="#111111" CREATED="1436874001933" ID="ID_190259601" MODIFIED="1436878789534" TEXT="find_best_connection/2">
<node COLOR="#111111" CREATED="1436874023662" ID="ID_624773566" MODIFIED="1436878539842" TEXT="&#x4ece;ordered_set ets:ibrowse_lb&#x4e2d;&#x627e;&#x4e2a;&#x8d1f;&#x8f7d;&#x6700;&#x5c11;&#x7684;&#x8fdb;&#x7a0b;"/>
<node COLOR="#111111" CREATED="1436874176509" ID="ID_33647685" MODIFIED="1436878539842" TEXT="&#x4ece;first&#x904d;&#x5386;&#x5230;end_of_table"/>
<node COLOR="#111111" CREATED="1436874207319" ID="ID_749570546" MODIFIED="1436878789534" TEXT="&#x627e;&#x5230;cur_sz&lt; Max_pipe &#x4e14;Speculative_sz&lt;Max_pipe ">
<node COLOR="#111111" CREATED="1436874472317" ID="ID_260665748" MODIFIED="1436878539843" TEXT="ets: update_counter Speculative_sz+1"/>
</node>
<node COLOR="#111111" CREATED="1436874420323" ID="ID_1443461162" MODIFIED="1436878789535" TEXT="&#x6ca1;&#x627e;&#x5230;&#x5c31;{error, retry_later}">
<node COLOR="#111111" CREATED="1436874435060" ID="ID_1568201070" MODIFIED="1436878539845" TEXT="&#x771f;&#x7684;&#x6ee1;&#x8d1f;&#x8377;&#x4e86;"/>
</node>
</node>
</node>
</node>
</node>
</node>
<node COLOR="#990000" CREATED="1436872568475" ID="ID_1162658887" MODIFIED="1436878789536" TEXT="ets:new ibrowse_conf">
<font NAME="SansSerif" SIZE="14"/>
<node COLOR="#111111" CREATED="1436872616687" ID="ID_1724425457" MODIFIED="1436878789537" STYLE="fork" TEXT="/priv/ibrowser.conf">
<font NAME="SansSerif" SIZE="12"/>
<node COLOR="#111111" CREATED="1436872662527" ID="ID_1383127383" MODIFIED="1436878539847" TEXT="&#x7528;&#x4e8e;&#x8d1f;&#x8f7d;&#x5747;&#x8861;&#x914d;&#x7f6e;"/>
<node COLOR="#111111" CREATED="1436872707579" ID="ID_784521663" MODIFIED="1436878539848" TEXT="{dest, Hostname, Portnumber, MaxSessions, MaxPipelineSize, Options}."/>
</node>
<node COLOR="#111111" CREATED="1436872728253" ID="ID_1501596185" MODIFIED="1436878539848" TEXT="&#x53ef;&#x4ee5;&#x4f7f;&#x7528;ibrowser:*config&#x6765;&#x52a8;&#x6001;&#x8c03;&#x6574;&#x914d;&#x7f6e;"/>
</node>
<node COLOR="#990000" CREATED="1436872582755" ID="ID_932075845" MODIFIED="1436878539849" TEXT="ets:new ibrowse_stream">
<font NAME="SansSerif" SIZE="14"/>
</node>
</node>
</node>
<node COLOR="#0033ff" CREATED="1436877598434" ID="ID_1443964209" MODIFIED="1436881069020" POSITION="left" TEXT="&#x7efc;&#x4e0a;&#xff1a;ibrowse.con&#x914d;&#x7f6e;">
<edge STYLE="sharp_bezier" WIDTH="8"/>
<font NAME="SansSerif" SIZE="18"/>
<node COLOR="#00b439" CREATED="1436877637700" ID="ID_1252815382" MODIFIED="1436878539853" TEXT="{dest,HostName,Portnumber,MaxSessions,MaxPipelineSize,Options}">
<edge STYLE="bezier" WIDTH="thin"/>
<font NAME="SansSerif" SIZE="16"/>
</node>
<node COLOR="#00b439" CREATED="1436877683141" ID="ID_1077736448" MODIFIED="1436878539855" TEXT="&#x4e3a;&#x6bcf;&#x5bf9;Hosname PortNum&#x5efa;&#x7acb;&#x4e00;&#x4e2a;gen_server">
<edge STYLE="bezier" WIDTH="thin"/>
<font NAME="SansSerif" SIZE="16"/>
</node>
<node COLOR="#00b439" CREATED="1436877738557" ID="ID_1150318205" MODIFIED="1436878539872" TEXT="Max_Sessions&#x4e3a;&#x6b64;gen_server&#x6700;&#x5927;&#x540c;&#x65f6;&#x53ef;&#x5904;&#x7406;&#x7684;session&#x8fde;&#x63a5;&#x6570;&#xff0c;&#x6b64;session&#x53c8;&#x662f;&#x4e00;&#x4e2a;&#x5b50;&#x7684;gen_server">
<edge STYLE="bezier" WIDTH="thin"/>
<font NAME="SansSerif" SIZE="16"/>
</node>
<node COLOR="#00b439" CREATED="1436877776405" ID="ID_308564514" MODIFIED="1436878539879" TEXT="MaxPipeLineSize:&#x4e3a;&#x76f4;&#x63a5;&#x5904;&#x7406;&#x8fde;&#x63a5;&#x7684;gen_server&#x7684;&#x540c;&#x65f6;&#x5904;&#x7406;&#x7684;&#x6700;&#x5927;&#x8bf7;&#x6c42;&#x6570;&#x80fd;&#x529b;">
<edge STYLE="bezier" WIDTH="thin"/>
<font NAME="SansSerif" SIZE="16"/>
</node>
</node>
</node>
</map>
